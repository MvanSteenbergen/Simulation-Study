{
  "hash": "a634b55d8add17c885d4c4ce17601bb9",
  "result": {
    "markdown": "---\ntitle: \"Running a Simulation Study\"\nformat: \n  pdf: default\ntidy: \"styler\"\n---\n\n\n## An Example of a statistical simulation\n\nSmall scale simulation study to investigate impact of measurement error on (continuous) exposure and/or (continuous) confounding variable. In epidemiological studies of the relation between an exposure and an outcome, this relation is often estimated using regression analysis. As an example, we consider a study of the association between glycated haemoglobin (HbA1c) levels and systolic blood pressure assessed using linear regression. Data from 5092 subjects in the 2015–2016 National Health and Nutrition Examination Survey (NHANES) are used to obtain an estimate of the effect of HbA1c on systolic blood pressure, while adjusting for age, gender and body mass index (BMI).\n\n\n\n\n\n## Analysis\n\nAfter adjustment for age and gender, it was estimated that HbA1c increases systolic blood pressure by 1.13 mmHg (95% CI 0.73 to 1.52) per unit increase in HbA1c.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(lm(bp ~ HbA1C + age + as.factor(sex), data=dc))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = bp ~ HbA1C + age + as.factor(sex), data = dc)\n\nResiduals:\nSystolic: Blood pres (1st rdg) mm Hg \n    Min      1Q  Median      3Q     Max \n-49.887 -10.509  -1.378   8.491 107.583 \n\nCoefficients:\n                Estimate Std. Error t value Pr(>|t|)    \n(Intercept)     98.75149    1.21418  81.332  < 2e-16 ***\nHbA1C            1.12638    0.20291   5.551 2.98e-08 ***\nage              0.44486    0.01284  34.648  < 2e-16 ***\nas.factor(sex)2 -3.24792    0.45164  -7.191 7.34e-13 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 16.1 on 5088 degrees of freedom\nMultiple R-squared:  0.2305,\tAdjusted R-squared:   0.23 \nF-statistic:   508 on 3 and 5088 DF,  p-value: < 2.2e-16\n```\n:::\n\n```{.r .cell-code}\nconfint(lm(bp ~ HbA1C + age + as.factor(sex), data=dc))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                     2.5 %      97.5 %\n(Intercept)     96.3711755 101.1317982\nHbA1C            0.7285836   1.5241825\nage              0.4196932   0.4700355\nas.factor(sex)2 -4.1333281  -2.3625106\n```\n:::\n:::\n\n\nAdditional adjustment for BMI resulted in a considerable change in the effect estimate: HbA1c was estimated to increase blood pressure by 0.75 mmHg (95% CI 0.35 to 1.16) per unit increase in HbA1c.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(lm(bp ~ HbA1C + bmi + age + as.factor(sex), data=dc))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = bp ~ HbA1C + bmi + age + as.factor(sex), data = dc)\n\nResiduals:\nSystolic: Blood pres (1st rdg) mm Hg \n    Min      1Q  Median      3Q     Max \n-51.068 -10.251  -1.504   8.264 107.410 \n\nCoefficients:\n                Estimate Std. Error t value Pr(>|t|)    \n(Intercept)     92.65583    1.39320  66.506  < 2e-16 ***\nHbA1C            0.75177    0.20596   3.650 0.000265 ***\nbmi              0.28632    0.03282   8.724  < 2e-16 ***\nage              0.44586    0.01275  34.979  < 2e-16 ***\nas.factor(sex)2 -3.63115    0.45049  -8.060  9.4e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 15.98 on 5087 degrees of freedom\nMultiple R-squared:  0.2418,\tAdjusted R-squared:  0.2412 \nF-statistic: 405.7 on 4 and 5087 DF,  p-value: < 2.2e-16\n```\n:::\n\n```{.r .cell-code}\nconfint(lm(bp ~ HbA1C + bmi + age + as.factor(sex), data=dc))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                     2.5 %     97.5 %\n(Intercept)     89.9245592 95.3871089\nHbA1C            0.3479966  1.1555348\nbmi              0.2219815  0.3506673\nage              0.4208695  0.4708464\nas.factor(sex)2 -4.5143014 -2.7479929\n```\n:::\n:::\n\n\n## Run the simulation study\n\nOne way to investigate the possible impact of measurement error is through a small simulation study.\nFor the purpose of this example, the original recordings in the NHANES\ndata were assumed to be measured without error.\nThen, in addition, new artificial variables were created that\nrepresented HbA1c and BMI, but for the situation in which these are\nmeasured with error. To create these variables, measurement error was\nartificially added to the exposure variable (HbA1c) and/or the\nconfounding variable (BMI).\nThese errors were drawn from a normal distribution with a mean zero and\nwere independent of all variables considered.\nThe variance of the normal distribution, defining the amount of\nmeasurement error added, was altered for different scenarios. Scenarios\nranged from no measurement error on either HbA1c or BMI (reference\nscenario) to 50% of the variance in HbA1c and/or BMI attributable to\nmeasurement error. To minimise the impact of simulation error, each\nscenario was repeated 1000 times and the results were averaged per\nscenario over these 1000 repetitions.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nref <- lm(bp ~ HbA1C + bmi + age + as.factor(sex), data=dc)$coef[2]\nn.sim <- 1e3\npb <- txtProgressBar(min=1, max= 1e3,style=3, 50)\nperc.me.exp <- seq(0,.5,.1)\nperc.me.conf<- seq(0,.5,.1)\nscenarios <- expand.grid(perc.me.exp,perc.me.conf)\nvar.exp <- var(dc$HbA1C)\nvar.conf <- var(dc$bmi)\nn <- dim(dc)[1]\nbeta.hat <- matrix(ncol=dim(scenarios)[1], nrow=n.sim)\n\n\n\nfor (k in 1:n.sim){\n  set.seed(k)\n  for (i in 1:dim(scenarios)[1]){\n    var.me.exp <- var.exp*scenarios[i,1]/(1-scenarios[i,1])\n    var.me.conf <- var.conf*scenarios[i,2]/(1-scenarios[i,2])\n    dc$HbA1C.me <- dc$HbA1C + rnorm(dim(dc)[1], 0, sqrt(var.me.exp))\n    dc$bmi.me <- dc$bmi + rnorm(dim(dc)[1], 0, sqrt(var.me.conf))\n    beta.hat[k,i] <- lm(bp ~ HbA1C.me + age + bmi.me + as.factor(sex), data=dc)$coef[2]\n    setTxtProgressBar(pb, k)\n  }}\n\nclose(pb)\n```\n:::\n\n\n## Results\n\nThus figure shows the impact of measurement error on HbA1c and/or BMI on the estimate of the regression coefficient of HbA1c .The relation between HbA1c and systolic blood pressure was attenuated when measurement error was added to HbA1c, but not when measurement error was added to BMI. The association became stronger as measurement error was added solely to the confounding variable BMI. The reason for this effect is that, with increasing levels of measurement error on BMI, adjustment for the confounding due to BMI becomes less efficient and the effect estimate gets closer to the unadjusted estimate (1.13 mmHg). Due to measurement error, a type of residual confounding is introduced. In the case of measurement error on HbA1c as well as BMI, both phenomena play a role and may cancel each other out. In this study, measurement error on HbA1c seemed more influential than measurement error on BMI.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntot.mat <- cbind(100*scenarios,apply(beta.hat,2,mean))\ncolnames(tot.mat) <- c(\"me.exp\",\"me.conf\",\"estimate\")\nggplot(tot.mat, aes(me.exp, me.conf)) +\n  geom_tile(color=\"white\",aes(fill = estimate)) +\n  geom_text(aes(label = round(estimate, 2))) +\n  scale_fill_gradient2(low=\"#D55E00\",\n                       mid=\"white\",\n                       high = \"#56B4E9\", \n                       midpoint=ref) +\n  labs(x=paste(\"% of total variance of HbA1c due to measurement error\"), \n       y=paste(\"% of total variance of BMI due to measurement error\")) +\n  coord_equal()+\n  scale_y_continuous(breaks=unique(tot.mat[,1]))+\n  scale_x_continuous(breaks=unique(tot.mat[,1]))+\n  theme(panel.background = element_rect(fill='white', colour='grey'), \n        plot.title=element_text(hjust=0), \n        axis.ticks=element_blank(),\n        axis.title=element_text(size=12),\n        axis.text=element_text(size=10),\n        legend.title=element_text(size=12),\n        legend.text=element_text(size=10))\n```\n\n::: {.cell-output-display}\n![](Running_a_Simulation_Study_files/figure-pdf/unnamed-chunk-5-1.pdf){fig-pos='H'}\n:::\n:::\n",
    "supporting": [
      "Running_a_Simulation_Study_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": null,
    "postProcess": false
  }
}